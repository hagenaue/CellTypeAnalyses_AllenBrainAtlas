#These code documents include all of the code used for the cell type analyses performed on the Allen Brain Atlas 160-region Agilent microarray dataset in the manuscript
##Megan Hagenauer, Alek Pankonin, and Isabelle Birt
##October 27 2016

#*****************************************

#Reading in the data

AllRegions_OneMatrix_SameOrder_Zscores<-read.csv("ABA_AllExpressionsNoEmptyRow.csv", header=T)
str(AllRegions_OneMatrix_SameOrder_Zscores)
temp<-AllRegions_OneMatrix_SameOrder_Zscores
AllRegions_OneMatrix_SameOrder_Zscores<-AllRegions_OneMatrix_SameOrder_Zscores[,-c(1,2)]
row.names(AllRegions_OneMatrix_SameOrder_Zscores)<-temp[,2]
rm(temp)
str(AllRegions_OneMatrix_SameOrder_Zscores)
# 'data.frame':	30000 obs. of  1014 variables:
# $ V2   : num  0.541 0.252 0.478 0.375 -0.405 ...
 # $ V3   : logi  NA NA NA NA NA NA ...
 # $ V4   : logi  NA NA NA NA NA NA ...
 # $ V5   : num  0.22 0.771 0.426 0.128 0.499 ...
 # $ V6   : num  1.0097 0.1136 0.3152 0.2098 0.0436 ...
 # $ V7   : num  0.853 0.525 0.357 0.462 0.183 ...
 # $ V8   : num  1.446 0.669 0.519 0.42 -0.884 ...


AllRegions_OneMatrix_SameOrder_SampleInfo<-read.csv("ABA_Columns.csv", header=T)
str(AllRegions_OneMatrix_SameOrder_SampleInfo)
# data.frame':	1014 obs. of  17 variables:
 # $ donor_id                        : int  9861 10021 12876 14380 15496 15697 9861 10021 12876 14380 ...
 # $ donor_name                      : Factor w/ 6 levels "H0351.1009","H0351.1012",..: 5 6 1 2 3 4 5 6 1 2 ...
 # $ donor_age                       : Factor w/ 6 levels "24 years","31 years",..: 1 3 6 2 4 5 1 3 6 2 ...
 # $ donor_color                     : Factor w/ 6 levels "0079C0","509800",..: 6 1 2 3 4 5 6 1 2 3 ...
 # $ sample_well                     : int  154 -1 -1 126426487 127687067 157773010 859 4668 11086 126431753 ...
 # $ sample_polygon                  : int  27255 -1 -1 1395862 121128826 155701387 39232 993106 1270929 1403264 ...
 # $ sample_mri_0                    : int  74 -1 -1 107 118 115 129 126 134 132 ...
 # $ sample_mri_1                    : int  96 -1 -1 133 125 123 78 79 99 121 ...
 # $ sample_mri_2                    : int  29 -1 -1 38 43 36 81 57 88 68 ...
 # $ structure_id                    : int  4053 4053 4053 4053 4053 4053 4078 4078 4078 4078 ...
 # $ structure_name                  : Factor w/ 160 levels "abducens nucleus",..: 6 6 6 6 6 6 44 44 44 44 ...
 # $ structure_abbreviation          : Factor w/ 169 levels "10","12","3",..: 13 13 13 13 13 13 63 63 63 63 ...
 # $ structure_color                 : Factor w/ 86 levels "00D5E8","00E8BB",..: 47 47 47 47 47 47 48 48 48 48 ...
 # $ top_level_structure_id          : int  4009 4009 4009 4009 4009 4009 4009 4009 4009 4009 ...
 # $ top_level_structure_name        : Factor w/ 27 levels "amygdala","basal forebrain",..: 11 11 11 11 11 11 11 11 11 11 ...
 # $ top_level_structure_abbreviation: Factor w/ 27 levels "Amg","BF","Bpons",..: 11 11 11 11 11 11 11 11 11 11 ...
 # $ top_level_structure_color       : Factor w/ 27 levels "00D5E8","00E8BB",..: 21 21 21 21 21 21 21 21 21 21 ...

#Note: Structure Name is column 11


ProbeInfo<-read.csv("ABA_AllProbesNoEmptyRow.csv", header=T)

# 'data.frame':	30000 obs. of  12 variables:
# str(ProbeInfo)
 # $ X             : int  2 3 4 5 6 7 8 9 10 11 ...
 # $ id            : int  1038360 1053962 1053210 1031532 1070322 1032754 1065870 1053653 1027786 1053652 ...
 # $ name          : Factor w/ 30000 levels "A_23_P100001",..: 6470 4308 27699 6733 18473 17522 1497 23129 20825 3800 ...
 # $ gene.id       : int  57211 4576 5141 122048 1011337 90407 1008239 4821 5701 4821 ...
 # $ gene.symbol   : Factor w/ 18787 levels "A_23_P100522",..: 7715 12772 14069 10627 4227 17913 114 13201 14781 13201 ...
 # $ gene.name     : Factor w/ 18769 levels "-","1-acylglycerol-3-phosphate O-acyltransferase 1 (lysophosphatidic acid acyltransferase, alpha)",..: 7857 17898 13847 13669 4592 17871 479 12381 13947 12381 ...
 # $ entrez.id     : int  81501 4602 5173 386618 0 257313 0 4852 5733 4852 ...
 # $ chromosome    : Factor w/ 29 levels "1","10","11",..: 23 21 14 5 25 17 25 22 1 22 ...
 # $ start.position: Factor w/ 1 level "n/a": 1 1 1 1 1 1 1 1 1 1 ...
 # $ end.position  : Factor w/ 1 level "n/a": 1 1 1 1 1 1 1 1 1 1 ...
 # $ p             : num  3.25e-14 7.57e-40 8.95e-22 2.10e-38 1.82e-26 ...
 # $ fold.change   : num  12.3 12 11.6 11.3 10.7 ...

#Note: Gene Symbol is column 5

sum(is.na(ProbeInfo[,5]))
length(unique(ProbeInfo[,5]))
# [1] 18787
length(unique(ProbeInfo[,4]))
# [1] 18790
